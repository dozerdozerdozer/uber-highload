# Uber

## 1. Тема и целевая аудитория

**Uber** — это международная платформа для заказа поездок, которая соединяет пассажиров с водителями. Сервис также
предлагает доставку еды через Uber Eats и услуги по доставке товаров. Uber предоставляет своим пользователям удобство
заказа транспортных услуг через приложение на смартфоне.

Ежедневная аудитория Uber составляет более 131 миллионов активных пользователей по всему миру. Наиболее крупные рынки
Uber — США, Канада, Латинская Америка, Европа и Азия.

| Регион                                     | Процентное соотношение |
|--------------------------------------------|------------------------|
| **Северная Америка**                       | 37%                    |
| **Европа, Ближний Восток и Африка (EMEA)** | 29%                    |
| **Латинская Америка**                      | 22%                    |
| **Азиатско-Тихоокеанский регион (APAC)**   | 12%                    |

| Возраст     | Процентное соотношение |
|-------------|------------------------|
| **16 – 24** | 47%                    |
| **25 – 34** | 28%                    |
| **35 – 44** | 17%                    |
| **45 – 54** | 12%                    |
| **55 – 64** | 6%                     |

MVP функционал:

1. Заказ поездок через приложение.
2. Геолокация для определения местоположения водителей и пассажиров.
3. Система рейтингов и отзывов для водителей и пассажиров.
4. Оплата поездки через приложение (поддержка оплаты наличными или картой).
5. История поездок и профили пользователей.
6. Расчет времени прибытия и стоимости поездки.
7. Возможность выбора типа тарифа (эконом, премиум и т.д.).

Ключевые продуктовые решения:

1. Алгоритмы, оптимизирующие маршруты и время подачи автомобиля.
2. Система динамического ценообразования, учитывающая спрос и предложение.
3. Уведомления пользователя о времени прибытия водителя и статусе поездки.
4. Возможность бронирования автомобилей заранее или в реальном времени.

## 2. Расчет нагрузки
   Для расчета нагрузки сервиса Uber, который имеет более 131 миллионов активных пользователей в месяц, нам необходимо оценить как продуктовые, так и технические метрики.

Продуктовые метрики:

 - Месячная аудитория - 131 млн пользователей
 - Дневная аудитория - ≈4.37 млн пользователей (предполагая, что 1/30 месячной аудитории активна ежедневно)
 - Средний размер хранилища пользователя - 100 КБ на пользователя (информация о профиле, история поездок, рейтинги и т.д.)
 - Среднее количество действий в день -  3 действия на пользователя в день (поиск поездки, заказ, завершение поездки)

### Технические метрики:

| Тип данных                | Размер хранилища               | Описание                                             |
|---------------------------|--------------------------------|------------------------------------------------------|
| **История поездок**       | 100 КБ на пользователя         | Включает информацию о предыдущих поездках, маршрутах |
| **Профили пользователей** | 50 КБ на пользователя          | Имя, контактная информация, фото, рейтинг и т.д.     |
| **Рейтинги и отзывы**     | 50 КБ на пользователя          | Система оценок и отзывов от водителей и пассажиров   |

### Трафик:

| Метрика                          | Значение                                                              |
|----------------------------------|-----------------------------------------------------------------------|
| **Пиковое потребление в сутки**  | ≈10 Гбит/с (по оценке трафика запросов и откликов)                    |
| **Сетевой трафик**               | ≈300 Гбайт/сутки (с учетом загрузки карты, истории поездок, профилей) |
| **RPS**                          | Среднее: 50k запросов/сек (поиск поездок, оплата, рейтинги)           |
| **Пиковый RPS**                  | 100k запросов/сек (в часы пик и массовых мероприятий)                 |

## 3. Глобальная балансировка нагрузки
###   Функциональное разбиение по доменам:

| Функционал                      | Домен         |
|---------------------------------|---------------|
| **Поиск поездок**               | auth.uber.com |
| **Оплата и завершение поездок** | pay.uber.com  |
| **Рейтинги и отзывы**           | rate.uber.com |
   Обоснования расположения дата-центров:
   Основные рынки Uber — это США, Канада, Латинская Америка, Европа и Азия. Дата-центры располагаются вблизи ключевых рынков для минимизации задержек и оптимизации взаимодействия с пользователями:

 - Северная Америка — США, Ашберн — 1 дата-центр (37% аудитории)
 - Европа — Германия, Франкфурт — 1 дата-центр (29% аудитории)
 - Латинская Америка — Бразилия, Сан-Паулу — 1 дата-центр (22% аудитории)
 - Азиатско-Тихоокеанский регион — Сингапур — 1 дата-центр (12% аудитории)

#### Схема DNS-балансировки:
 - Распределение трафика осуществляется через географическую балансировку DNS, чтобы направлять пользователей к ближайшему дата-центру.
 - Anycast балансировка используется для распределения запросов на уровне сети, позволяя одному IP-адресу обслуживаться из нескольких мест.
#### Механизм регулировки трафика:
В случае перегрузки одного из дата-центров, система может перенаправлять трафик в соседние дата-центры. Например, если дата-центр в США перегружен, часть запросов может быть перенаправлена в Латинскую Америку.

## 4. Локальная балансировка нагрузки
   Для каждого дата-центра используется следующая схема локальной балансировки:

 - Load Balancers (LBs) распределяют трафик между серверами внутри дата-центра.
 - Auto-scaling механизм автоматически увеличивает или уменьшает количество активных серверов в зависимости от нагрузки.
 - Caching на уровне серверов для минимизации обращений к базе данных по неактуальным данным (например, истории поездок).


Список источников:

1. [Uber Statistics 2024](https://www.demandsage.com/uber-statistics/)
2. [Uber: How the ride-hailing app works](https://www.techradar.com/how-to/how-uber-works).
